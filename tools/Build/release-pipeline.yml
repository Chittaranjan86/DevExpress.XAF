# https://aka.ms/yaml
resources:
- repo: self
trigger: none
queue:
  name: Hosted VS2017
  demands: 
  - msbuild
  - visualstudio
steps:
- powershell: |
   $script=Get-Content .\go.ps1
   $version=[System.Text.RegularExpressions.Regex]::Match($script,'version=\"([^\"]*)\"').groups[1].Value
   Write-Verbose -Verbose "##vso[build.updatebuildnumber]$version"
   #.\go.ps1 -msbuild "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\MSBuild\15.0\Bin\msbuild.exe" -packageSources $(DXApiFeed) 
  displayName: 'Build'
  failOnStderr: true
- task: NuGetCommand@2
  displayName: 'NuGet push'
  inputs:
    command: push
    nuGetFeedType: external
    packagesToPush: '$(System.DefaultWorkingDirectory)/bin/nuget/*.nupkg'
    publishFeedCredentials: Nuget.org

